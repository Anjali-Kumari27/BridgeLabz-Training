/*Exercise 3: Advanced Features
Build a library management system with:
• Book inventory
• Student borrowing records
• Fine calculation
• Search functionality with multiple filters
 */



mysql> use dbmspractice;
Database changed
mysql> create table books (book_id INT PRIMARY KEY, title VARCHAR(150), author VARCHAR(100), genre VARCHAR(50), total_copies INT, available_copies INT);
Query OK, 0 rows affected (0.07 sec)

mysql> desc books;
+------------------+--------------+------+-----+---------+-------+
| Field            | Type         | Null | Key | Default | Extra |
+------------------+--------------+------+-----+---------+-------+
| book_id          | int          | NO   | PRI | NULL    |       |
| title            | varchar(150) | YES  |     | NULL    |       |
| author           | varchar(100) | YES  |     | NULL    |       |
| genre            | varchar(50)  | YES  |     | NULL    |       |
| total_copies     | int          | YES  |     | NULL    |       |
| available_copies | int          | YES  |     | NULL    |       |
+------------------+--------------+------+-----+---------+-------+
6 rows in set (0.01 sec)

mysql> create table students(student_id INT PRIMARY KEY, student_name VARCHAR(100), department VARCHAR(50));
Query OK, 0 rows affected (0.06 sec)

mysql> CREATE TABLE borrow_records (
    ->     borrow_id INT AUTO_INCREMENT PRIMARY KEY,
    ->     student_id INT,
    ->     book_id INT,
    ->     issue_date DATE,
    ->     due_date DATE,
    ->     return_date DATE,
    ->     fine DECIMAL(10,2) DEFAULT 0
    -> );
Query OK, 0 rows affected (0.05 sec)


=======================================================================
                          BOOK INVENTORY
=======================================================================


mysql> insert into books VALUES (1, 'One Indian Girl', "Chetan Bhagat", "Fiction", 5, 5),
    -> (2, "The White Tiger", "Aravind Adiga", "Social Commentary", 6, 6),
    -> (3, "I am Malala", "Malala Yousafzai", "Autobiography", 4, 4);
Query OK, 3 rows affected (0.04 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql> insert into students values (101, "Anjali", "CSE"),(102,"Arpita","Law");
Query OK, 2 rows affected (0.04 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql> select * from books;
+---------+-----------------+------------------+-------------------+--------------+------------------+
| book_id | title           | author           | genre             | total_copies | available_copies |
+---------+-----------------+------------------+-------------------+--------------+------------------+
|       1 | One Indian Girl | Chetan Bhagat    | Fiction           |            5 |                5 |
|       2 | The White Tiger | Aravind Adiga    | Social Commentary |            6 |                6 |
|       3 | I am Malala     | Malala Yousafzai | Autobiography     |            4 |                4 |
+---------+-----------------+------------------+-------------------+--------------+------------------+
3 rows in set (0.00 sec)

mysql> select * from students;;
+------------+--------------+------------+
| student_id | student_name | department |
+------------+--------------+------------+
|        101 | Anjali       | CSE        |
|        102 | Arpita       | Law        |
+------------+--------------+------------+
2 rows in set (0.00 sec)


=========================================================================
                  STUDENT BORROWING RECORDS
=========================================================================

mysql> START TRANSACTION;
Query OK, 0 rows affected (0.00 sec)

mysql> INSERT INTO borrow_records
    -> (student_id, book_id, issue_date, due_date)
    -> VALUES (101, 1, CURDATE(), DATE_ADD(CURDATE(), INTERVAL 14 DAY));
Query OK, 1 row affected (0.03 sec)

mysql> UPDATE books
    -> SET available_copies = available_copies - 1
    -> WHERE book_id = 1 AND available_copies > 0;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> COMMIT;
Query OK, 0 rows affected (0.03 sec)

mysql> UPDATE borrow_records
    -> SET return_date = CURDATE(),
    ->     fine = GREATEST(DATEDIFF(CURDATE(), due_date), 0) * 10
    -> WHERE borrow_id = 1;
Query OK, 1 row affected (0.03 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> UPDATE books
    -> SET available_copies = available_copies + 1
    -> WHERE book_id = 1;
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> SELECT s.student_name, b.title, br.issue_date, br.due_date, br.return_date, br.fine
    -> FROM borrow_records br
    -> JOIN students s ON br.student_id = s.student_id
    -> JOIN books b ON br.book_id = b.book_id
    -> WHERE s.student_id = 101;
+--------------+-----------------+------------+------------+-------------+------+
| student_name | title           | issue_date | due_date   | return_date | fine |
+--------------+-----------------+------------+------------+-------------+------+
| Anjali       | One Indian Girl | 2026-02-08 | 2026-02-22 | 2026-02-08  | 0.00 |
+--------------+-----------------+------------+------------+-------------+------+
1 row in set (0.00 sec)



==========================================================================
                        FINE CALCULATION
=========================================================================



mysql> SELECT student_id, SUM(fine) AS total_fine
    -> FROM borrow_records
    -> WHERE student_id = 101;
+------------+------------+
| student_id | total_fine |
+------------+------------+
|        101 |       0.00 |
+------------+------------+
1 row in set (0.03 sec)




=========================================================================
                SEARCH FUNCTIONALITY WITH MULTIPLE FILTERS
=========================================================================


**********************
BY BOOK TITLE
**********************


mysql> select * from books where title LIKE '%GIRL%';
+---------+-----------------+---------------+---------+--------------+------------------+
| book_id | title           | author        | genre   | total_copies | available_copies |
+---------+-----------------+---------------+---------+--------------+------------------+
|       1 | One Indian Girl | Chetan Bhagat | Fiction |            5 |                5 |
+---------+-----------------+---------------+---------+--------------+------------------+
1 row in set (0.00 sec)



**********************
BY AUTHOR NAME
**********************


mysql> select * from books where author LIKE '%CHETAN%';
+---------+-----------------+---------------+---------+--------------+------------------+
| book_id | title           | author        | genre   | total_copies | available_copies |
+---------+-----------------+---------------+---------+--------------+------------------+
|       1 | One Indian Girl | Chetan Bhagat | Fiction |            5 |                5 |
+---------+-----------------+---------------+---------+--------------+------------------+
1 row in set (0.00 sec)




**********************
BY GENRE
**********************


mysql> select * from books where genre="autobiography";
+---------+-------------+------------------+---------------+--------------+------------------+
| book_id | title       | author           | genre         | total_copies | available_copies |
+---------+-------------+------------------+---------------+--------------+------------------+
|       3 | I am Malala | Malala Yousafzai | Autobiography |            4 |                4 |
+---------+-------------+------------------+---------------+--------------+------------------+
1 row in set (0.00 sec)




**********************
BY COPIES AVIALABLE
**********************


mysql> SELECT * FROM books
    -> WHERE available_copies > 0;
+---------+-----------------+------------------+-------------------+--------------+------------------+
| book_id | title           | author           | genre             | total_copies | available_copies |
+---------+-----------------+------------------+-------------------+--------------+------------------+
|       1 | One Indian Girl | Chetan Bhagat    | Fiction           |            5 |                5 |
|       2 | The White Tiger | Aravind Adiga    | Social Commentary |            6 |                6 |
|       3 | I am Malala     | Malala Yousafzai | Autobiography     |            4 |                4 |
+---------+-----------------+------------------+-------------------+--------------+------------------+
3 rows in set (0.00 sec)